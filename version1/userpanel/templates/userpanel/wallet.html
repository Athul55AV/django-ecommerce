{% extends 'userpanel/base.html' %}
{% load static %}


{% block Home %}

<div class="container mt-5">
    <h2 class="mb-4">ðŸ’° My Wallet</h2>

    <div class="card mb-4 shadow-sm p-4 d-flex flex-column align-items-center">
        <h4>Current Balance: <strong>â‚¹{{ wallet.balance }}</strong></h4>
        {% comment %} <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addMoneyModal" style="width: 200px;">
            âž• Add Money
        </button> {% endcomment %}
    </div>

    <!-- Add Money Modal -->
    <div class="modal fade" id="addMoneyModal" tabindex="-1" aria-labelledby="addMoneyLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="POST" action="{% url 'add_money' %}">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title" id="addMoneyLabel">Add Money to Wallet</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <label>Enter Amount (â‚¹):</label>
              <input type="number" step="0.01" min="1" name="amount" class="form-control" required>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Add Money</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Transaction Table -->
    <div class="card mt-4 shadow-sm p-4" style="margin-bottom: 200px;">
        <h5 class="mb-3">Transaction History</h5>
        {% if transactions %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Transaction Type</th>
                    <th>Amount (â‚¹)</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transactions %}
                <tr>
                    <td>{{ t.created_at|date:"M d, Y H:i" }}</td>
                    <td>
                        {% if t.transaction_type == 'CREDIT' %}
                            <span class="text-success">+ Credit</span>
                        {% else %}
                            <span class="text-danger">- Debit</span>
                        {% endif %}
                    </td>
                    <td>{{ t.amount }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted">No transactions yet.</p>
        {% endif %}
    </div>
</div>

<script>
    // Redirect to index page when user presses browser back button
    history.pushState(null, null, location.href);
    window.addEventListener("popstate", function () {
        window.location.href = "{% url 'index' %}";
    });
</script>



{% endblock Home %}